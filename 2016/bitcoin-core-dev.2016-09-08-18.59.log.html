<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<title>#bitcoin-core-dev log</title>
<style type="text/css">
/* For the .log.html */
pre { /*line-height: 125%;*/
      white-space: pre-wrap; }
body { background: #f0f0f0; }

body .tm  { color: #007020 }                      /* time */
body .nk  { color: #062873; font-weight: bold }   /* nick, regular */
body .nka { color: #007020; font-weight: bold }  /* action nick */
body .ac  { color: #00A000 }                      /* action line */
body .hi  { color: #4070a0 }                 /* hilights */
/* Things to make particular MeetBot commands stick out */
body .topic     { color: #007020; font-weight: bold }
body .topicline { color: #000080; font-weight: bold }
body .cmd       { color: #007020; font-weight: bold }
body .cmdline  { font-weight: bold }

</style>
</head>

<body>
<pre><a name="l-1"></a><span class="tm">18:59:58</span><span class="nk"> &lt;wumpus&gt;</span> <span class="cmd">#startmeeting</span><span class="cmdline"></span>
<a name="l-2"></a><span class="tm">18:59:58</span><span class="nk"> &lt;lightningbot&gt;</span> Meeting started Thu Sep  8 18:59:58 2016 UTC.  The chair is wumpus. Information about MeetBot at http://wiki.debian.org/MeetBot.
<a name="l-3"></a><span class="tm">18:59:58</span><span class="nk"> &lt;lightningbot&gt;</span> Useful Commands: #action #agreed #help #info #idea #link #topic.
<a name="l-4"></a><span class="tm">19:00:09</span><span class="nk"> &lt;wumpus&gt;</span> <span class="cmd">#bitcoin-core-dev </span><span class="cmdline">Meeting: wumpus sipa gmaxwell jonasschnelli morcos luke-jr btcdrak sdaftuar jtimon cfields petertodd kanzure bluematt instagibbs phantomcircuit codeshark michagogo marcofalke paveljanik NicolasDorier</span>
<a name="l-5"></a><span class="tm">19:00:14</span><span class="nk"> &lt;morcos&gt;</span> here
<a name="l-6"></a><span class="tm">19:00:19</span><span class="nk"> &lt;CodeShark&gt;</span> here
<a name="l-7"></a><span class="tm">19:00:24</span><span class="nk"> &lt;jeremyrubin&gt;</span> here
<a name="l-8"></a><span class="tm">19:00:28</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">topic:</span> sing morcos happy birthday
<a name="l-9"></a><span class="tm">19:00:29</span><span class="nk"> &lt;petertodd&gt;</span> here
<a name="l-10"></a><span class="tm">19:00:30</span><span class="nk"> &lt;btcdrak&gt;</span> here
<a name="l-11"></a><span class="tm">19:00:31</span><span class="nk"> &lt;cfields&gt;</span> thanks, here
<a name="l-12"></a><span class="tm">19:00:33</span><span class="nk"> &lt;kanzure&gt;</span> here
<a name="l-13"></a><span class="tm">19:00:35</span><span class="nk"> &lt;petertodd&gt;</span> <span class="hi">BlueMatt:</span> ack!
<a name="l-14"></a><span class="tm">19:00:40</span><span class="nk"> &lt;wumpus&gt;</span> happy birthday morcos
<a name="l-15"></a><span class="tm">19:00:41</span><span class="nk"> &lt;jeremyrubin&gt;</span> leaked PII
<a name="l-16"></a><span class="tm">19:00:46</span><span class="nk"> &lt;btcdrak&gt;</span> gmaxwell you missed jl2012
<a name="l-17"></a><span class="tm">19:00:47</span><span class="nk"> &lt;kanzure&gt;</span> <span class="hi">wumpus:</span> no doxxing :)
<a name="l-18"></a><span class="tm">19:00:51</span><span class="nk"> &lt;jeremyrubin&gt;</span> Alex sing your ssn!
<a name="l-19"></a><span class="tm">19:00:52</span><span class="nk"> &lt;petertodd&gt;</span> <span class="hi">kanzure:</span> lol
<a name="l-20"></a><span class="tm">19:01:01</span><span class="nk"> &lt;michagogo&gt;</span> Happy birthday!
<a name="l-21"></a><span class="tm">19:01:02</span><span class="nk"> &lt;luke-jr&gt;</span> <span class="hi">morcos:</span> happy birthday https://www.youtube.com/watch?v=dQw4w9WgXcQ
<a name="l-22"></a><span class="tm">19:01:02</span><span class="nk"> &lt;morcos&gt;</span> thanks
<a name="l-23"></a><span class="tm">19:01:12</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">morcos:</span> congrats
<a name="l-24"></a><span class="tm">19:01:14</span><span class="nk"> &lt;jcorgan&gt;</span> here in spirit only
<a name="l-25"></a><span class="tm">19:01:24</span><span class="nk"> &lt;btcdrak&gt;</span> saved by DCMA filters "The uploader has not made this video available in your country."
<a name="l-26"></a><span class="tm">19:01:25</span><span class="nk"> &lt;jonasschnelli&gt;</span> <span class="hi">morcos:</span> hey! happy birthday.
<a name="l-27"></a><span class="tm">19:01:27</span><span class="nk"> &lt;petertodd&gt;</span> <span class="hi">kanzure:</span> happy birthday to anyone who considers themselves born on this date
<a name="l-28"></a><span class="tm">19:01:39</span><span class="nk"> &lt;kanzure&gt;</span> much better.
<a name="l-29"></a><span class="tm">19:01:43</span><span class="nk"> &lt;petertodd&gt;</span> <span class="hi">btcdrak:</span> the copyright on happy birthday got overturned :)
<a name="l-30"></a><span class="tm">19:01:53</span><span class="nk"> &lt;btcdrak&gt;</span> <span class="hi">petertodd:</span> click the link
<a name="l-31"></a><span class="tm">19:02:07</span><span class="nk"> &lt;wumpus&gt;</span> anyone with proposed topics?
<a name="l-32"></a><span class="tm">19:02:08</span><span class="nk"> &lt;petertodd&gt;</span> <span class="hi">btcdrak:</span> oh, that's a great song
<a name="l-33"></a><span class="tm">19:02:27</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">wumpus:</span> just one: we have quite a queue of things for 0.13.1, and i'd like to encourage people to review
<a name="l-34"></a><span class="tm">19:02:31</span><span class="nk"> &lt;BlueMatt&gt;</span> real topic: segwit-cb bip
<a name="l-35"></a><span class="tm">19:02:32</span><span class="nk"> &lt;btcdrak&gt;</span> <span class="hi">wumpus:</span> birthday cake
<a name="l-36"></a><span class="tm">19:02:35</span><span class="nk"> &lt;kanzure&gt;</span> not a topic proposal, but i would like to eventually get a resolution on the after_failure weirdness
<a name="l-37"></a><span class="tm">19:03:01</span><span class="nk"> &lt;jonasschnelli&gt;</span> I just wanted to let you know that there will be two hack days on monday and tuesday 10th and 11th of October after the SB conference in Milan.
<a name="l-38"></a><span class="tm">19:03:17</span><span class="nk"> &lt;petertodd&gt;</span> <span class="hi">jonasschnelli:</span> I'll be there
<a name="l-39"></a><span class="tm">19:03:30</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">btcdrak:</span> the list was just based the top participants in the past.
<a name="l-40"></a><span class="tm">19:03:30</span><span class="nk"> &lt;jonasschnelli&gt;</span> More info and registration will follow...
<a name="l-41"></a><span class="tm">19:03:33</span><span class="nk"> &lt;wumpus&gt;</span> yes last week there was an ACTION for "Support for compact blocks together with segwit" (#8393), there has been a bit of review activity in last days, what's the status there?
<a name="l-42"></a><span class="tm">19:04:05</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">wumpus:</span> I've been doing some testing. There aren't many segwit transactions on testnet currently. I was going to call for people to create more once I got more testing setup.
<a name="l-43"></a><span class="tm">19:04:06</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">BlueMatt:</span> i haven't reviewed the changes for the bip you suggested - does it require any code changes to the bitcoin core pr?
<a name="l-44"></a><span class="tm">19:04:32</span><span class="nk"> &lt;wumpus&gt;</span> <span class="cmd">#info </span><span class="cmdline">jonasschnelli: I just wanted to let you know that there will be two hack days on monday and tuesday 10th and 11th of October after the SB conference in Milan. More info and registration will follow...</span>
<a name="l-45"></a><span class="tm">19:04:40</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">sipa:</span> possibly, two options, though, one minor, one slightly more
<a name="l-46"></a><span class="tm">19:04:45</span><span class="nk"> &lt;btcdrak&gt;</span> maybe we can ask roasbeef to help tx generation there
<a name="l-47"></a><span class="tm">19:04:57</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">gmaxwell:</span> more segwit transactions would help, yes :)
<a name="l-48"></a><span class="tm">19:05:30</span><span class="nk"> &lt;sipa&gt;</span> can we pick a topic?
<a name="l-49"></a><span class="tm">19:05:45</span><span class="nk"> &lt;wumpus&gt;</span> <span class="cmd">#link </span><span class="cmdline">re: queue of things for 0.13.1, link is https://github.com/bitcoin/bitcoin/milestones/0.13.1</span>
<a name="l-50"></a><span class="tm">19:06:15</span><span class="nk"> &lt;wumpus&gt;</span> <span class="topic">#topic </span><span class="topicline">segwit-cb bip</span>
<a name="l-51"></a><span class="tm">19:06:18</span><span class="nk"> &lt;btcdrak&gt;</span> <span class="hi">jl2012:</span> is everything you are working correctly tagged (or not) for 0.13.1?
<a name="l-52"></a><span class="tm">19:06:44</span><span class="nk"> &lt;BlueMatt&gt;</span> so, to quote github issue "The last commit changes the protocol entirely, adding a cmpctack message. This has the advantage that you could implement receiving of some version of compactlocks without implementing sending that encoding, as well as simplifying the protocol slightly (instead of having to check if the current protocol version is higher-priority according to your probably-compile-time list of supported version you know
<a name="l-53"></a><span class="tm">19:06:44</span><span class="nk"> &lt;BlueMatt&gt;</span> which version you're using directly from the ack message) at the expensee of complicating the implementation somewhat (now you have to add support for another message type and special-case version 1). The last commit is definitely not worth it if we dont anticipate adding more than one or so more versions, but might be worth it if we anticipate compact blocks version 4, 5, 6 at some point. I'll bring this up in the IRC meeting later
<a name="l-54"></a><span class="tm">19:06:50</span><span class="nk"> &lt;BlueMatt&gt;</span> today."
<a name="l-55"></a><span class="tm">19:07:11</span><span class="nk"> &lt;BlueMatt&gt;</span> essentially, the current proposal is that you annoucne the set of compact block versions you want at startup (BIP text says before you send any pong or other compact block messages)
<a name="l-56"></a><span class="tm">19:07:22</span><span class="nk"> &lt;BlueMatt&gt;</span> and each sendcmpct announce implies that you are willing to encode to those
<a name="l-57"></a><span class="tm">19:07:33</span><span class="nk"> &lt;jl2012&gt;</span> <span class="hi">btcdrak:</span> including those already tagged, I think 8685, 8654 and 8635 are also for 0.13.1
<a name="l-58"></a><span class="tm">19:07:41</span><span class="nk"> &lt;BlueMatt&gt;</span> and you send them in the priority of what you want to receive
<a name="l-59"></a><span class="tm">19:07:58</span><span class="nk"> &lt;BlueMatt&gt;</span> and the version you use to send is the first one you receive from the other side that you also sent
<a name="l-60"></a><span class="tm">19:08:01</span><span class="nk"> &lt;jl2012&gt;</span> at least we may consider to include in 0.13.1
<a name="l-61"></a><span class="tm">19:08:17</span><span class="nk"> &lt;BlueMatt&gt;</span> and you use the highest-priority one the other side also announced to decode
<a name="l-62"></a><span class="tm">19:08:33</span><span class="nk"> &lt;BlueMatt&gt;</span> (comment text from above link https://github.com/bitcoin/bips/pull/423#issuecomment-245629813 )
<a name="l-63"></a><span class="tm">19:08:53</span><span class="nk"> &lt;sipa&gt;</span> i'm not a fan of changing the code again after all testing, but i do agree it's a cleaner solution, and will make things easier for future extensions
<a name="l-64"></a><span class="tm">19:08:55</span><span class="nk"> &lt;BlueMatt&gt;</span> so this is obviously somewhat complicated
<a name="l-65"></a><span class="tm">19:09:16</span><span class="nk"> &lt;BlueMatt&gt;</span> and the solution would be to introduce a cmpctack which you use to pick the one you want to encode to
<a name="l-66"></a><span class="tm">19:09:34</span><span class="nk"> &lt;sipa&gt;</span> cmpctack containing the version you picked?
<a name="l-67"></a><span class="tm">19:09:40</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">jl2012:</span> (tagged. number of pulls for 0.13.1 does seem to be getting a bit out of hand)
<a name="l-68"></a><span class="tm">19:09:57</span><span class="nk"> &lt;gmaxwell&gt;</span> can we have some discussion about this outside of the meeting, I want to ask some questions but I think it'll be a design rathole right now. :)
<a name="l-69"></a><span class="tm">19:10:02</span><span class="nk"> &lt;BlueMatt&gt;</span> simplifying the which-do-i-use-to-decode code from "for each sendcmpct msg received, is this higher priority than the previously-highest-prirotiy one" to "the one I saw in a sendcmpct"
<a name="l-70"></a><span class="tm">19:10:14</span><span class="nk"> &lt;BlueMatt&gt;</span> in practice the proposed cmpctack is way more code, but a bit simpler
<a name="l-71"></a><span class="tm">19:10:21</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">BlueMatt:</span> ok, i'll review and adapt the pr
<a name="l-72"></a><span class="tm">19:10:32</span><span class="nk"> &lt;BlueMatt&gt;</span> s/""the one I saw in a sendcmpct"/""the one I saw in a cmpctack"/g
<a name="l-73"></a><span class="tm">19:10:32</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">gmaxwell:</span> ok
<a name="l-74"></a><span class="tm">19:10:38</span><span class="nk"> &lt;BlueMatt&gt;</span> I, personally, dont really like the cmpctack idea
<a name="l-75"></a><span class="tm">19:10:52</span><span class="nk"> &lt;sipa&gt;</span> so what alternative do you propose?
<a name="l-76"></a><span class="tm">19:10:52</span><span class="nk"> &lt;sdaftuar&gt;</span> i do like the cmpctack idea!
<a name="l-77"></a><span class="tm">19:10:52</span><span class="nk"> &lt;BlueMatt&gt;</span> certainly if we plan on having lots of versions, it is simpler protocol-wise
<a name="l-78"></a><span class="tm">19:10:56</span><span class="nk"> &lt;jl2012&gt;</span> <span class="hi">wumpus:</span> most of mine are pretty trivial. I am no able to do more than that anyway
<a name="l-79"></a><span class="tm">19:11:15</span><span class="nk"> &lt;BlueMatt&gt;</span> if we only ever have version 1 and 2 and maybe like a 3, then the previous proposal seems perfectly ok to me
<a name="l-80"></a><span class="tm">19:11:27</span><span class="nk"> &lt;morcos&gt;</span> My viewpoint is that we suffer a history of technical debt, and we have a chance now while compact blocks are new to kind of clean up the protocol messages with a bit less fuss
<a name="l-81"></a><span class="tm">19:11:36</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">morcos:</span> agree
<a name="l-82"></a><span class="tm">19:11:38</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">sipa:</span> either way I'm proposing to switch the priority order to first-is-highest from last-is-highest
<a name="l-83"></a><span class="tm">19:11:39</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">jl2012:</span> agreed
<a name="l-84"></a><span class="tm">19:11:42</span><span class="nk"> &lt;morcos&gt;</span> so we shoudl take the added changes now to be happier later with a better design
<a name="l-85"></a><span class="tm">19:11:51</span><span class="nk"> &lt;luke-jr&gt;</span> would it ever make sense to support a per-block encoding? for example, if nodes at some point want to pass blocks along as-is from peer A to other peers when possible
<a name="l-86"></a><span class="tm">19:12:01</span><span class="nk"> &lt;BlueMatt&gt;</span> note that we have to introduce a backwards compatibility hack if we do cmpctack
<a name="l-87"></a><span class="tm">19:12:17</span><span class="nk"> &lt;gmaxwell&gt;</span> I think it's fine to clean things up. But at some point the correct 'upgrade' is to just introduce a seperate mechenism sendcmpt2 and drop the old one, rather than extending.
<a name="l-88"></a><span class="tm">19:12:25</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">BlueMatt:</span> just say that if no ack is ever sent, it is implicitly for v1
<a name="l-89"></a><span class="tm">19:12:25</span><span class="nk"> &lt;luke-jr&gt;</span> <span class="hi">BlueMatt:</span> do we? old CBs will die with segwit anyway..
<a name="l-90"></a><span class="tm">19:13:38</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">sipa:</span> this implies you have to announce sendcmpct version 1
<a name="l-91"></a><span class="tm">19:13:39</span><span class="nk"> &lt;gmaxwell&gt;</span> past some point trying to create a forever design just guarentees technical debt of a different kind. :)
<a name="l-92"></a><span class="tm">19:13:48</span><span class="nk"> &lt;BlueMatt&gt;</span> which the proposal for creating a cmpctack would not do
<a name="l-93"></a><span class="tm">19:14:03</span><span class="nk"> &lt;morcos&gt;</span> we should maybe do as gmaxwell said and discuss after meeting, but i don't think we actually need a hack, you just need to still tell 0.13 nodes that you support v1 and they only understand that by sending them a sendcmpct 1
<a name="l-94"></a><span class="tm">19:14:08</span><span class="nk"> &lt;morcos&gt;</span> but it doesn't hurt to send that to everyone
<a name="l-95"></a><span class="tm">19:14:12</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">alternatively:</span> compact block version 3 can be called something other than compact blocks
<a name="l-96"></a><span class="tm">19:14:15</span><span class="nk"> &lt;BlueMatt&gt;</span> then you can do whatever :P
<a name="l-97"></a><span class="tm">19:14:19</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">BlueMatt:</span> hahaha
<a name="l-98"></a><span class="tm">19:14:27</span><span class="nk"> &lt;sipa&gt;</span> i could live with that too.
<a name="l-99"></a><span class="tm">19:14:29</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">BlueMatt:</span> yea, thats what I was saying, effectively.
<a name="l-100"></a><span class="tm">19:14:59</span><span class="nk"> &lt;gmaxwell&gt;</span> besides the general framework here has limitations, further latency optinization should basically be a non-goal, because the fiber approach is vastly better in that respect.
<a name="l-101"></a><span class="tm">19:15:12</span><span class="nk"> &lt;BlueMatt&gt;</span> anyway, its taken 15 minutes to explain what the issues are, so maybe decide later, or let other topics go ahead first
<a name="l-102"></a><span class="tm">19:15:39</span><span class="nk"> &lt;wumpus&gt;</span> I don't think any other topics have been (seriously) proposed
<a name="l-103"></a><span class="tm">19:16:15</span><span class="nk"> &lt;wumpus&gt;</span> so go ahead
<a name="l-104"></a><span class="tm">19:16:29</span><span class="nk"> &lt;jl2012&gt;</span> I got to go. See you
<a name="l-105"></a><span class="tm">19:16:38</span><span class="nk"> &lt;morcos&gt;</span> proposed topic: picking a segwit rollout date and announcing this in a wider format
<a name="l-106"></a><span class="tm">19:16:38</span><span class="nk"> &lt;wumpus&gt;</span> see you later jl2012
<a name="l-107"></a><span class="tm">19:16:47</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">jl2012:</span> good night
<a name="l-108"></a><span class="tm">19:16:52</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">BlueMatt:</span> how about just sending sendcmpct2 for v2 :)
<a name="l-109"></a><span class="tm">19:17:00 </span><span class="nka">* sipa</span> <span class="ac">hides</span>
<a name="l-110"></a><span class="tm">19:17:16</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">morcos:</span> I think the blocker there was basically having all the things merged in 0.13 branch that we believe would be needed on our end.
<a name="l-111"></a><span class="tm">19:17:18</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">alternatively:</span> version negotiation protocol examples are at https://github.com/bitcoin/bips/blob/833dea41c4c757087ef4c35e3b19259ba2f80128/bip-0152.mediawiki#Sample_Version_Implementation and https://github.com/bitcoin/bips/blob/0d9b12cf285762e8ff661fe17e3261d014af1581/bip-0152.mediawiki#Sample_Version_Implementation
<a name="l-112"></a><span class="tm">19:17:19</span><span class="nk"> &lt;cfields&gt;</span> topic suggestion: rpc sync assumptions
<a name="l-113"></a><span class="tm">19:17:36</span><span class="nk"> &lt;btcdrak&gt;</span> need review of these backport #8679, should be simple enough
<a name="l-114"></a><span class="tm">19:18:07</span><span class="nk"> &lt;BlueMatt&gt;</span> though I think the second misses the fact that you have to use sendcmpct instead of cmpctack if its version 1
<a name="l-115"></a><span class="tm">19:18:21</span><span class="nk"> &lt;instagibbs_&gt;</span> oh hi. znc bouncer is broke or something.
<a name="l-116"></a><span class="tm">19:18:34</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">gmaxwell:</span> yeah i've been a bit out of touch, and i can see that makes sense..   but i also think it would be nice to give as much warning to the community as possible as to when we are proposing to actually release this
<a name="l-117"></a><span class="tm">19:19:08</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">morcos:</span> yes, a message that says "This will happen soon, our side waiting for X" to give people a chance to raise any concerns would be reasonable, I think.
<a name="l-118"></a><span class="tm">19:19:12</span><span class="nk"> &lt;instagibbs_&gt;</span> /release/activate/ ?
<a name="l-119"></a><span class="tm">19:19:21</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">instagibbs_:</span> yes, both
<a name="l-120"></a><span class="tm">19:19:25</span><span class="nk"> &lt;CodeShark&gt;</span> we've been giving that message for several weeks already ;)
<a name="l-121"></a><span class="tm">19:19:30</span><span class="nk"> &lt;wumpus&gt;</span> <span class="topic">#topic </span><span class="topicline">picking a segwit rollout date and announcing this in a wider format</span>
<a name="l-122"></a><span class="tm">19:19:56</span><span class="nk"> &lt;instagibbs_&gt;</span> I've been pointing out the remaining milestone list, but it's a bit opaque for people who aren't actively reviewing stuff
<a name="l-123"></a><span class="tm">19:19:58</span><span class="nk"> &lt;gmaxwell&gt;</span> I went around to soem forks and asked for what their scheduling looked like and the response I got was basically 'after it's deployed in the network'
<a name="l-124"></a><span class="tm">19:20:05</span><span class="nk"> &lt;sipa&gt;</span> we can't propose a rollout date before knowing when we can have 0.13.1 out, and there are quite a few things to work out for that
<a name="l-125"></a><span class="tm">19:20:24</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">sipa:</span> yeah i suppose i agree
<a name="l-126"></a><span class="tm">19:20:26</span><span class="nk"> &lt;CodeShark&gt;</span> I'd rather not pile on additional scheduling issues externally unless we're confident
<a name="l-127"></a><span class="tm">19:20:56</span><span class="nk"> &lt;achow101&gt;</span> is a 0.12.2 backport still happening?
<a name="l-128"></a><span class="tm">19:21:01</span><span class="nk"> &lt;instagibbs_&gt;</span> Would the amount of lead time differ once we've merged all remaining issuess?
<a name="l-129"></a><span class="tm">19:21:07</span><span class="nk"> &lt;wumpus&gt;</span> yes it seems 0.13.1 is a lot more work than expected
<a name="l-130"></a><span class="tm">19:21:17</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">achow101:</span> I don't think so
<a name="l-131"></a><span class="tm">19:21:51</span><span class="nk"> &lt;btcdrak&gt;</span> <span class="hi">achow101:</span> segwit needs compact block relay, so very unlikely.
<a name="l-132"></a><span class="tm">19:22:15</span><span class="nk"> &lt;achow101&gt;</span> ok
<a name="l-133"></a><span class="tm">19:22:17</span><span class="nk"> &lt;luke-jr&gt;</span> "needs"?
<a name="l-134"></a><span class="tm">19:22:22</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">achow101:</span> getting this into 0.13 in the first place and assuring it is correct is a lot of work, I doubt anyone can pile up the extra work for 0.12
<a name="l-135"></a><span class="tm">19:22:51</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">luke-jr:</span> yea, what? segwit doesnt NEED it
<a name="l-136"></a><span class="tm">19:23:00</span><span class="nk"> &lt;instagibbs_&gt;</span> And no one seems to be demanding it, more importantly
<a name="l-137"></a><span class="tm">19:23:05</span><span class="nk"> &lt;BlueMatt&gt;</span> just might be painful if you dont have it
<a name="l-138"></a><span class="tm">19:23:15</span><span class="nk"> &lt;btcdrak&gt;</span> unless you are happy with bigger blocks being relayed without it...
<a name="l-139"></a><span class="tm">19:23:24</span><span class="nk"> &lt;btcdrak&gt;</span> anyway. weeds.
<a name="l-140"></a><span class="tm">19:23:33</span><span class="nk"> &lt;sipa&gt;</span> yes, weeds
<a name="l-141"></a><span class="tm">19:24:07</span><span class="nk"> &lt;instagibbs_&gt;</span> Which PRs need the most attention at this point
<a name="l-142"></a><span class="tm">19:24:07</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">achow101:</span> no we pretty much decided to not do a 0.12. backport over a month ago.
<a name="l-143"></a><span class="tm">19:24:10</span><span class="nk"> &lt;wumpus&gt;</span> weeds?
<a name="l-144"></a><span class="tm">19:24:18</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">wumpus:</span> "we're getting into the weeds"
<a name="l-145"></a><span class="tm">19:24:24</span><span class="nk"> &lt;wumpus&gt;</span> ohh
<a name="l-146"></a><span class="tm">19:24:34</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">achow101:</span> not worth the risk and resource investment, and no one was jumping to do it. From measurements and feedback we've found that virtually no one uses backport releases.
<a name="l-147"></a><span class="tm">19:24:35</span><span class="nk"> &lt;instagibbs_&gt;</span> mfw pieter is explaining English idioms
<a name="l-148"></a><span class="tm">19:24:42</span><span class="nk"> &lt;CodeShark&gt;</span> in the netherlands that might have a different meaning ;)
<a name="l-149"></a><span class="tm">19:24:45</span><span class="nk"> &lt;jonasschnelli&gt;</span> heh
<a name="l-150"></a><span class="tm">19:24:50</span><span class="nk"> &lt;wumpus&gt;</span> yes, 0.12 just isn't a very important topic right now, let's focus on moving forward
<a name="l-151"></a><span class="tm">19:24:56</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">CodeShark:</span> yes :)
<a name="l-152"></a><span class="tm">19:25:20</span><span class="nk"> &lt;luke-jr&gt;</span> also, if someone really needs 0.12, they can put it behind a 0.13.1 node
<a name="l-153"></a><span class="tm">19:25:21</span><span class="nk"> &lt;wumpus&gt;</span> next topic?
<a name="l-154"></a><span class="tm">19:25:47</span><span class="nk"> &lt;wumpus&gt;</span> <span class="topic">#topic </span><span class="topicline">rpc sync assumptions</span>
<a name="l-155"></a><span class="tm">19:25:57</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">luke-jr:</span> precisely, and any sw backport would create the disruption people were trying to avoid in staying with an older version.
<a name="l-156"></a><span class="tm">19:26:29</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">wumpus:</span> I don't understand why people thought it was a problem that getbalance could return a "mid block" response.
<a name="l-157"></a><span class="tm">19:26:32</span><span class="nk"> &lt;morcos&gt;</span> just to be clear, the change to reduce cs_main locks is only for 0.14, so we don't have to worry about rpc sync assumptions for 0.13.1 right?
<a name="l-158"></a><span class="tm">19:26:35</span><span class="nk"> &lt;cfields&gt;</span> so, marcos pointed out that the reason that the rpc tests are failing and fix is needed is that we broke some timing assumptions by optimizing some stuff
<a name="l-159"></a><span class="tm">19:27:10</span><span class="nk"> &lt;cfields&gt;</span> so the question is: are those assumptions ok to break (just fix the tests), or are they part of the api?
<a name="l-160"></a><span class="tm">19:27:28</span><span class="nk"> &lt;cfields&gt;</span> wow, re-reading that, that's incredibly vague :)
<a name="l-161"></a><span class="tm">19:27:33</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">morcos:</span> yes
<a name="l-162"></a><span class="tm">19:27:36</span><span class="nk"> &lt;jonasschnelli&gt;</span> Can you make a clear example?
<a name="l-163"></a><span class="tm">19:27:46</span><span class="nk"> &lt;gmaxwell&gt;</span> I think the question should be what do we think the best behavior is. And if the best behavior changes the API, we should do it and document the change.
<a name="l-164"></a><span class="tm">19:27:57</span><span class="nk"> &lt;jeremyrubin&gt;</span> WalletSync expected to occur in test
<a name="l-165"></a><span class="tm">19:28:02</span><span class="nk"> &lt;jonasschnelli&gt;</span> Do we assume the wallet has processed a transaction after getting informed of a blockupdate?
<a name="l-166"></a><span class="tm">19:28:04</span><span class="nk"> &lt;jeremyrubin&gt;</span> *under the lock
<a name="l-167"></a><span class="tm">19:28:08</span><span class="nk"> &lt;luke-jr&gt;</span> does "mid block" include "numbers are being changed, so the value is unlike either the previous OR the next correct value"?
<a name="l-168"></a><span class="tm">19:28:09</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">gmaxwell:</span> I don't know either, there's no guarantee that blocks are atomically processed by the wallet
<a name="l-169"></a><span class="tm">19:28:25</span><span class="nk"> &lt;sipa&gt;</span> we can make it atomic, as pointed out by morcos earlier
<a name="l-170"></a><span class="tm">19:28:26</span><span class="nk"> &lt;jonasschnelli&gt;</span> s/blockupdate/tipupdate
<a name="l-171"></a><span class="tm">19:28:32</span><span class="nk"> &lt;wumpus&gt;</span> but is it necessary?
<a name="l-172"></a><span class="tm">19:28:32</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">luke-jr:</span> it reflects the full effect of some of the txs in the block but not all
<a name="l-173"></a><span class="tm">19:28:48</span><span class="nk"> &lt;gmaxwell&gt;</span> my understanding is that the tests are doing things like handing a node a block, then instantly checking the wallet, and expecting it to be fully consistent with the block right away. Is this understanding correct?
<a name="l-174"></a><span class="tm">19:28:55</span><span class="nk"> &lt;sipa&gt;</span> my alternative is that we make the wallet aware of the current tip it knows about, and we let confirmations be computed based on that
<a name="l-175"></a><span class="tm">19:29:07</span><span class="nk"> &lt;sipa&gt;</span> that means that mid-block update you can see unconfirmed transactions
<a name="l-176"></a><span class="tm">19:29:12</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">jonasschnelli:</span> ex: you do a getblockheight rpc call - under previous versions if you then do a getbalance that balance is up to date to that block, this is no longer true
<a name="l-177"></a><span class="tm">19:29:19</span><span class="nk"> &lt;wumpus&gt;</span> the tests need proper synchronization commands, some of those need to be implemented, I don't think we need to change the whole API for that
<a name="l-178"></a><span class="tm">19:29:24</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">wumpus:</span> well before we get to the atomic block question, there is the question of whether if you wait for the blockchain to be synced to some height, and then query the wallet whether you are getting wallet values of at least that height (mid-block or not)
<a name="l-179"></a><span class="tm">19:29:25</span><span class="nk"> &lt;cfields&gt;</span> <span class="hi">gmaxwell:</span> correct. as soon as the height/hash is reflected, they assume the wallet is synced with that height/hash
<a name="l-180"></a><span class="tm">19:29:32</span><span class="nk"> &lt;wumpus&gt;</span> (besides adding those syncronization commands)
<a name="l-181"></a><span class="tm">19:29:54</span><span class="nk"> &lt;jonasschnelli&gt;</span> Can we not just have the wallets bestblock in getwalletinfo and use it for sync with getchaintips?
<a name="l-182"></a><span class="tm">19:29:54</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">sipa:</span> I think mid-block updates is a blatant violation of the "principal of least surprise"
<a name="l-183"></a><span class="tm">19:30:00</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">morcos:</span> okay, I think sipa's suggestion would address that esp with coupled with a way of asking for the wallet's tip.
<a name="l-184"></a><span class="tm">19:30:10</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">morcos:</span> well it would make sense for the wallet to track where it is, synchronization-wise, absolutely
<a name="l-185"></a><span class="tm">19:30:22</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">BlueMatt:</span> uh then we need to remove unconfirmed transactions too?!
<a name="l-186"></a><span class="tm">19:30:24</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">morcos:</span>  and for thtat info to be available externally
<a name="l-187"></a><span class="tm">19:30:41</span><span class="nk"> &lt;luke-jr&gt;</span> showing a best-wallet-block would make the whole mid-block state even more broken IMO (what best-block will it show mid-state?)
<a name="l-188"></a><span class="tm">19:30:44</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">BlueMatt:</span> there can always be unconfirmed transactions in the wallet
<a name="l-189"></a><span class="tm">19:30:47</span><span class="nk"> &lt;BlueMatt&gt;</span> and, further, if wallet is allowed to return something that is not up to date with the start of the call, this changes literally our entire api....so now anyone using the rpc has to go re-audit all of their uses of it???
<a name="l-190"></a><span class="tm">19:30:53</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">luke-jr:</span> the previous one
<a name="l-191"></a><span class="tm">19:30:56</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">sipa:</span> huh? I mean things mid-block...am I missing what you said?
<a name="l-192"></a><span class="tm">19:31:01</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">luke-jr:</span> it will update its state when its done processing updates, of course.
<a name="l-193"></a><span class="tm">19:31:03</span><span class="nk"> &lt;morcos&gt;</span> fixing the mid-block thing seems pretty trivial to me, why wouldnt' we just do that
<a name="l-194"></a><span class="tm">19:31:07</span><span class="nk"> &lt;jonasschnelli&gt;</span> <span class="hi">luke-jr:</span> the bestblock should only be updated after fully processing? Right?
<a name="l-195"></a><span class="tm">19:31:23</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">sipa:</span> i was under the impression you indicated that you would see txn which come later in that block as unconfirmed, while txn earlier in the block are marked confirmed
<a name="l-196"></a><span class="tm">19:31:28</span><span class="nk"> &lt;gmaxwell&gt;</span> Why are people regarding mid block as a bug?!?
<a name="l-197"></a><span class="tm">19:31:31</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">BlueMatt:</span> no
<a name="l-198"></a><span class="tm">19:31:44</span><span class="nk"> &lt;gmaxwell&gt;</span> at _any_ time a transaction can show up and appear in the wallet, unrelated to any blocks.
<a name="l-199"></a><span class="tm">19:31:51</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">gmaxwell:</span> b/c its not a feature?
<a name="l-200"></a><span class="tm">19:31:57</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">BlueMatt:</span> mid-update you would see the transactions of the new block as unconfirmed
<a name="l-201"></a><span class="tm">19:32:00</span><span class="nk"> &lt;luke-jr&gt;</span> that seems the most obvious behaviour, but if you look at bestblock+balance, I would think them a pair, yet balance might be bestblock+partOfNextBlock in reality?
<a name="l-202"></a><span class="tm">19:32:02</span><span class="nk"> &lt;morcos&gt;</span> i mean does anyone want that
<a name="l-203"></a><span class="tm">19:32:03</span><span class="nk"> &lt;BlueMatt&gt;</span> ahh, yes, ok, so i was just confused....txn which appear in wallet before the block has processed seems reasonable
<a name="l-204"></a><span class="tm">19:32:07</span><span class="nk"> &lt;gmaxwell&gt;</span> Unless you want to remove unconfirmed transactions that will always happen.
<a name="l-205"></a><span class="tm">19:32:27</span><span class="nk"> &lt;sipa&gt;</span> i also don't think there is any problem with grabbing a wallet lock during the update
<a name="l-206"></a><span class="tm">19:32:36</span><span class="nk"> &lt;wumpus&gt;</span> so if changing the balance mid-block is regarded as a bug, that should apply to all other state too: the transaction list, for example. It should hold all updates until it processed the entire block
<a name="l-207"></a><span class="tm">19:32:36</span><span class="nk"> &lt;sipa&gt;</span> which would prevent seeing a mid-update state
<a name="l-208"></a><span class="tm">19:32:42</span><span class="nk"> &lt;sipa&gt;</span> i'm just questioning if it is necessary
<a name="l-209"></a><span class="tm">19:32:56</span><span class="nk"> &lt;gmaxwell&gt;</span> it seems strange to me to hurt concurrency to protect a property that we don't actually have (due to unconfirmed transactions)
<a name="l-210"></a><span class="tm">19:33:01</span><span class="nk"> &lt;wumpus&gt;</span> I don't think using the lock for that is a good thing
<a name="l-211"></a><span class="tm">19:33:21</span><span class="nk"> &lt;wumpus&gt;</span> agree with gmaxwell
<a name="l-212"></a><span class="tm">19:33:23</span><span class="nk"> &lt;jonasschnelli&gt;</span> From the wallet perspective processing doesn't matter, you just want to see confirmations... can slowly appear on a tx list IMO
<a name="l-213"></a><span class="tm">19:33:23</span><span class="nk"> &lt;cfields&gt;</span> <span class="hi">wumpus:</span> right, that made me cringe. That seems like a major layer violation
<a name="l-214"></a><span class="tm">19:33:36</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">wumpus:</span> gmaxwell: but can you explain what concurrency we are hurting?
<a name="l-215"></a><span class="tm">19:33:44</span><span class="nk"> &lt;morcos&gt;</span> i'm not suggesting we put cs_main covering those again
<a name="l-216"></a><span class="tm">19:33:49</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">morcos:</span> you have to hold the lock *all* the time while processing the block
<a name="l-217"></a><span class="tm">19:33:53</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">gmaxwell:</span> if it were listing your *confirmed* balance as mid-block, then it would be an issue
<a name="l-218"></a><span class="tm">19:33:54</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">wumpus:</span> no
<a name="l-219"></a><span class="tm">19:34:00</span><span class="nk"> &lt;gmaxwell&gt;</span> Wallet processing shouldn't stall when the node is processing a block, at least not any more than strictly necessary.
<a name="l-220"></a><span class="tm">19:34:01</span><span class="nk"> &lt;BlueMatt&gt;</span> which I believe is what people are worried about
<a name="l-221"></a><span class="tm">19:34:07</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">wumpus:</span> the proposal is to grab cs_wallet during the wallet updating for the block
<a name="l-222"></a><span class="tm">19:34:10 </span><span class="nka">* luke-jr</span> <span class="ac">wonders if there's a good way to use listsinceblock</span>
<a name="l-223"></a><span class="tm">19:34:17</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">wumpus:</span> which happens in its entirety after main processes the block
<a name="l-224"></a><span class="tm">19:34:19</span><span class="nk"> &lt;morcos&gt;</span> i'm just suggesting we use cs_wallet or some other lock that prevents a wallet specific call from returning until you are no longer in the middle of a loop that calls SyncWithWallets (on a given block)
<a name="l-225"></a><span class="tm">19:34:36</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">wumpus:</span> cs_main isn't even held at the point
<a name="l-226"></a><span class="tm">19:34:36</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">sipa:</span> I know, but you'd still be holding the wallet lock longer than necessary
<a name="l-227"></a><span class="tm">19:34:45</span><span class="nk"> &lt;BlueMatt&gt;</span> to be fair, all of this should move onto a background thread in the future anyway
<a name="l-228"></a><span class="tm">19:34:50</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">morcos:</span> so now wallet calls will stall block processing? (when the block processing waits to take that lock?)
<a name="l-229"></a><span class="tm">19:34:50</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">BlueMatt:</span> agreed on that
<a name="l-230"></a><span class="tm">19:34:59</span><span class="nk"> &lt;sipa&gt;</span> yes, and it may be harder to maining if we parallellize/asynchronize things more
<a name="l-231"></a><span class="tm">19:35:02</span><span class="nk"> &lt;wumpus&gt;</span> wallet block processing should be async at some point
<a name="l-232"></a><span class="tm">19:35:16</span><span class="nk"> &lt;BlueMatt&gt;</span> so this would be a temporary fix that we should consider something which will happen on a background thread...lets not get too focused on blocking block processing with it
<a name="l-233"></a><span class="tm">19:35:22</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">morcos:</span> do you think there is a problem with showing the transactions from the being-processed-block as unconfirmed during the update?
<a name="l-234"></a><span class="tm">19:35:24</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">gmaxwell:</span> hmmm, yes i suppose while thats in the main thread thats a bad idea
<a name="l-235"></a><span class="tm">19:35:36</span><span class="nk"> &lt;jonasschnelli&gt;</span> IMO the wallet should process a copy of the block on its own, own thread
<a name="l-236"></a><span class="tm">19:35:43</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">jonasschnelli:</span> yes yes
<a name="l-237"></a><span class="tm">19:35:47</span><span class="nk"> &lt;CodeShark&gt;</span> ^]
<a name="l-238"></a><span class="tm">19:35:49</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">sipa:</span> probably it will already be in the wallet as unconfirmed anyhow
<a name="l-239"></a><span class="tm">19:35:50</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">jonasschnelli:</span> i think everyone agrees on that
<a name="l-240"></a><span class="tm">19:35:52</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">BlueMatt:</span> I'm fine with temporary fixes, I'm just confused as to why anything needs to be fixed here except some unrealistic expectations in the tests.
<a name="l-241"></a><span class="tm">19:36:05</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">gmaxwell:</span> i believe the current situation is broken
<a name="l-242"></a><span class="tm">19:36:20</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">sipa:</span> great. I'd like to understand why.
<a name="l-243"></a><span class="tm">19:36:25</span><span class="nk"> &lt;sipa&gt;</span> mid-update you can see half of the block reflected as confirmed transactions, and miss other transactions from that same block
<a name="l-244"></a><span class="tm">19:36:32</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">gmaxwell:</span> two issues: getbalance, by default, shows your *confirmed* balance, so you expect that to be consistent...right now it is not clear (I maybe wrong) that it might not show *half* of your actually confirmed balance
<a name="l-245"></a><span class="tm">19:36:51</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">sipa:</span> i think i need to go look more carefully at what SyncWithWallets does with txs from the block, but for instance, coudl you end up removing a conflicted tx, then showing a balance, without having addd the replacement tx yet.  i think yes, and i think thats would be confusing
<a name="l-246"></a><span class="tm">19:36:53</span><span class="nk"> &lt;gmaxwell&gt;</span> okay, I agree showing confirmed for some and not others is odd. Showing some and not others, however I think is fine, and consistent with the normal behavior.
<a name="l-247"></a><span class="tm">19:37:05</span><span class="nk"> &lt;cfields&gt;</span> let's not focus on the details here. The question at hand (mine, anyway), is whether the blocking behavior from 0.13 is considered part of the api, or if it's ok to deviate. If the answer is the latter, we can just fix the tests and move on.
<a name="l-248"></a><span class="tm">19:37:19</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">cfields:</span> blocking what behaviour?
<a name="l-249"></a><span class="tm">19:37:27</span><span class="nk"> &lt;sipa&gt;</span> 0.13 does not have this change
<a name="l-250"></a><span class="tm">19:37:52</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">cfields:</span> i think there is something that needs to be fixed in master, that is deeper than fixing up tests
<a name="l-251"></a><span class="tm">19:37:56</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">cfields:</span> but it may not be much
<a name="l-252"></a><span class="tm">19:38:11</span><span class="nk"> &lt;cfields&gt;</span> <span class="hi">sipa:</span> right, 0.13 doesn't give up the lock
<a name="l-253"></a><span class="tm">19:38:21</span><span class="nk"> &lt;sipa&gt;</span> indeed, 0.13 is totally fine
<a name="l-254"></a><span class="tm">19:38:27</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">gmaxwell:</span> second, we are making an API change here, which it seems to me is probably going to break clients: previously if you called getblockheigh, and then getbalance, getbalance will be up-to-date at least as of that block...this is no longer true. I can absolutely see clients having assumed this
<a name="l-255"></a><span class="tm">19:38:29</span><span class="nk"> &lt;wumpus&gt;</span> "okay, I agree showing confirmed for some and not others is odd" absolutely. This would break the assumption that curtip-block which tx was confirmed in is the number of confirmations
<a name="l-256"></a><span class="tm">19:38:37</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">cfields:</span> That the wallet blocks shouldn't be part of the api. Certian consistency properties might reasonably be.  I'm actually dubious that seeing confirmations incrementally is actually a problem.
<a name="l-257"></a><span class="tm">19:38:57</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">BlueMatt:</span> no, thats not really true either, since the chain can reorg between those two calls.
<a name="l-258"></a><span class="tm">19:39:07</span><span class="nk"> &lt;cfields&gt;</span> <span class="hi">sipa:</span> right. and now master has changed that behavior. So if the behavior is considered to be part of the api, we need to revert it
<a name="l-259"></a><span class="tm">19:39:10</span><span class="nk"> &lt;jonasschnelli&gt;</span> Why can't we not just use SyncWithWallets or mempool and add a SyncBlockWithWallet(blockcopy) for added and removed tips? Process it in a wallet-thread (similar to periodic flushes) and use cs_wallet there?
<a name="l-260"></a><span class="tm">19:39:11</span><span class="nk"> &lt;morcos&gt;</span> ok, how about i write up an issue
<a name="l-261"></a><span class="tm">19:39:20</span><span class="nk"> &lt;cfields&gt;</span> (I don't believe that and I'd -1 it. Just clarifying)
<a name="l-262"></a><span class="tm">19:39:43</span><span class="nk"> &lt;morcos&gt;</span> i don't think we should revert the change
<a name="l-263"></a><span class="tm">19:39:58</span><span class="nk"> &lt;wumpus&gt;</span> we shouldn't revert anything that prevents future paralellization/concurrency
<a name="l-264"></a><span class="tm">19:40:12</span><span class="nk"> &lt;sipa&gt;</span> i think the step was a step in the right direction, and we should continue it
<a name="l-265"></a><span class="tm">19:40:22</span><span class="nk"> &lt;sipa&gt;</span> but we have time in 0.14 to figure out exactly how
<a name="l-266"></a><span class="tm">19:40:23</span><span class="nk"> &lt;wumpus&gt;</span> if there is a need to 'force everything to wait for thewallet' that's a big -1 from me too
<a name="l-267"></a><span class="tm">19:40:25</span><span class="nk"> &lt;morcos&gt;</span> i think we should make it so that the existing rpc calls returns omething that make sense.  two issues 1) once you've waited for a certain height, that once you ask for balance you get a balance of at least that height 2) whether mid-block updates are ok
<a name="l-268"></a><span class="tm">19:40:29</span><span class="nk"> &lt;gmaxwell&gt;</span> how does this concurrency interact with the wallet's mempool interaction. The wallet cares if tx are in mempool or not, will a wallet look unconfirmed and fallen out of the mempool briefly while it's confirming?
<a name="l-269"></a><span class="tm">19:40:32</span><span class="nk"> &lt;morcos&gt;</span> 1) needs fixing, 2) needs more investigation
<a name="l-270"></a><span class="tm">19:40:55</span><span class="nk"> &lt;cfields&gt;</span> agreed. ok, that answers my question.
<a name="l-271"></a><span class="tm">19:41:03</span><span class="nk"> &lt;morcos&gt;</span> 1) can be fixed with cfields existing code from 8680 without harming any concurrency
<a name="l-272"></a><span class="tm">19:41:04</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">morcos:</span> 1) is easily fixed by reporting the wallet height rather than the core height
<a name="l-273"></a><span class="tm">19:41:10</span><span class="nk"> &lt;jonasschnelli&gt;</span> <span class="hi">morcos:</span> isn't 1) and 2) solvable from the wallet side?
<a name="l-274"></a><span class="tm">19:41:17</span><span class="nk"> &lt;wumpus&gt;</span> wallet height and core height are different things
<a name="l-275"></a><span class="tm">19:41:25</span><span class="nk"> &lt;sdaftuar&gt;</span> <span class="hi">sipa:</span> yes, but that would be api-breaking right?
<a name="l-276"></a><span class="tm">19:41:29</span><span class="nk"> &lt;wumpus&gt;</span> it has always been possible to confound these, but that has to change
<a name="l-277"></a><span class="tm">19:41:32</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">sdaftuar:</span> i believe not
<a name="l-278"></a><span class="tm">19:41:34</span><span class="nk"> &lt;sdaftuar&gt;</span> i think that's the right idea though
<a name="l-279"></a><span class="tm">19:41:57</span><span class="nk"> &lt;gmaxwell&gt;</span> Well it means that someone might need to look in a different place for the wallet height, no?
<a name="l-280"></a><span class="tm">19:42:04</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">sdaftuar:</span> if we make 0.14 report the wallet height,  i believe it will look equivalent to 0.13
<a name="l-281"></a><span class="tm">19:42:09</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">gmaxwell:</span> yes, it'd need to be a wallet RPC
<a name="l-282"></a><span class="tm">19:42:24</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">sipa:</span> the issue is people probably already use getblockcount and then ask for balances
<a name="l-283"></a><span class="tm">19:42:32</span><span class="nk"> &lt;wumpus&gt;</span> either on getwalletinfo or getwalletblockcount
<a name="l-284"></a><span class="tm">19:42:37</span><span class="nk"> &lt;morcos&gt;</span> but they do that in their code
<a name="l-285"></a><span class="tm">19:42:38</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">morcos:</span> so, make getblockcount by default report the wallet height
<a name="l-286"></a><span class="tm">19:42:46</span><span class="nk"> &lt;wumpus&gt;</span> bah
<a name="l-287"></a><span class="tm">19:42:48</span><span class="nk"> &lt;morcos&gt;</span> that seems like a crazy change
<a name="l-288"></a><span class="tm">19:42:53</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">morcos:</span> thats okay, we would release note that in 0.14. If it's the right behavior to change we shouldn't hesitate to do so here.
<a name="l-289"></a><span class="tm">19:42:58</span><span class="nk"> &lt;sipa&gt;</span> why? it's exactly what we've been doing all the time
<a name="l-290"></a><span class="tm">19:43:02</span><span class="nk"> &lt;wumpus&gt;</span> change getblockcount to a wallet call?!
<a name="l-291"></a><span class="tm">19:43:10</span><span class="nk"> &lt;jonasschnelli&gt;</span> no
<a name="l-292"></a><span class="tm">19:43:13</span><span class="nk"> &lt;sdaftuar&gt;</span> that means you need wallet support to use that rpc?
<a name="l-293"></a><span class="tm">19:43:15</span><span class="nk"> &lt;CodeShark&gt;</span> bad idea
<a name="l-294"></a><span class="tm">19:43:15</span><span class="nk"> &lt;morcos&gt;</span> i think we're getting a bit too worked up
<a name="l-295"></a><span class="tm">19:43:16</span><span class="nk"> &lt;sdaftuar&gt;</span> blech
<a name="l-296"></a><span class="tm">19:43:16</span><span class="nk"> &lt;wumpus&gt;</span> what if there is no wallet built in?
<a name="l-297"></a><span class="tm">19:43:25</span><span class="nk"> &lt;sipa&gt;</span> sigh
<a name="l-298"></a><span class="tm">19:43:26</span><span class="nk"> &lt;jonasschnelli&gt;</span> no blockcount!
<a name="l-299"></a><span class="tm">19:43:26</span><span class="nk"> &lt;gmaxwell&gt;</span> that woudl be kind of odd, but it's 99% of the time used as a wallet call, ... and we have getblockchaininfo....
<a name="l-300"></a><span class="tm">19:43:29</span><span class="nk"> &lt;wumpus&gt;</span> what if there are multiple wallets? ask them all, return the max value?
<a name="l-301"></a><span class="tm">19:43:38</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">gmaxwell:</span> certain people have reorg handling code, this api change will not trigger their reorg handling code and will still break clients!
<a name="l-302"></a><span class="tm">19:43:42</span><span class="nk"> &lt;sipa&gt;</span> so deprepcate the RPC
<a name="l-303"></a><span class="tm">19:43:49</span><span class="nk"> &lt;jonasschnelli&gt;</span> Just give out the bestblockhash in getwalletinfo
<a name="l-304"></a><span class="tm">19:43:49</span><span class="nk"> &lt;BlueMatt&gt;</span> it is absolutely not unreasonable for this change to break rpc clients
<a name="l-305"></a><span class="tm">19:43:50</span><span class="nk"> &lt;sipa&gt;</span> and introduce a wallet-specific one and main-specific one
<a name="l-306"></a><span class="tm">19:43:53</span><span class="nk"> &lt;morcos&gt;</span> its easy enough to make wallet balance calls wait on their own until either the wallet reports a height that matches chainactive height or using cfields mechanism, that slows nothing other than that wallet call and solves 1
<a name="l-307"></a><span class="tm">19:44:00</span><span class="nk"> &lt;cfields&gt;</span> why not just have getblockcount block until the block is finished processing (all signals, not wallet specific)? New apis can be async
<a name="l-308"></a><span class="tm">19:44:08</span><span class="nk"> &lt;wumpus&gt;</span> yes, there needs to be a wallet-specific one
<a name="l-309"></a><span class="tm">19:44:12</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">cfields:</span> that's just delaying the problem
<a name="l-310"></a><span class="tm">19:44:20</span><span class="nk"> &lt;BlueMatt&gt;</span> what morcos said
<a name="l-311"></a><span class="tm">19:44:22</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">BlueMatt:</span> look, the API is not, should not, and cannot be a suicide pact. We're talking about an change in a major version, and one that would only require minor changes. _WE CAN CHANGE THE API_.
<a name="l-312"></a><span class="tm">19:44:23</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">cfields:</span> because that's no longer possible if the wallet works asynchronously
<a name="l-313"></a><span class="tm">19:44:25</span><span class="nk"> &lt;BlueMatt&gt;</span> just block wallet calls until they are caught up
<a name="l-314"></a><span class="tm">19:44:44</span><span class="nk"> &lt;gmaxwell&gt;</span> Especially in a minor way like "get your height for purpose X this way instead of that"
<a name="l-315"></a><span class="tm">19:44:54</span><span class="nk"> &lt;wumpus&gt;</span> wallet processing blocking wallet calls is OK
<a name="l-316"></a><span class="tm">19:44:55</span><span class="nk"> &lt;BlueMatt&gt;</span> there is a simple solution to this that doesnt require all the users audit their codebase
<a name="l-317"></a><span class="tm">19:44:58</span><span class="nk"> &lt;BlueMatt&gt;</span> that isnt even a big deal
<a name="l-318"></a><span class="tm">19:44:58</span><span class="nk"> &lt;wumpus&gt;</span> wallet processing blocking core calls is not
<a name="l-319"></a><span class="tm">19:45:06</span><span class="nk"> &lt;BlueMatt&gt;</span> but you're arguing we change the api because its simpler?
<a name="l-320"></a><span class="tm">19:45:22</span><span class="nk"> &lt;BlueMatt&gt;</span> just block wallet rpc calls until its caught up at the start of the cs_wallet lock
<a name="l-321"></a><span class="tm">19:45:35</span><span class="nk"> &lt;BlueMatt&gt;</span> yes, wumpus, dont think anyone is arguing for that
<a name="l-322"></a><span class="tm">19:45:36</span><span class="nk"> &lt;gmaxwell&gt;</span> I haven't heard anything suggested that doesn't require having the wallet and block processing block each other.
<a name="l-323"></a><span class="tm">19:45:43</span><span class="nk"> &lt;BlueMatt&gt;</span> noooo
<a name="l-324"></a><span class="tm">19:45:45</span><span class="nk"> &lt;BlueMatt&gt;</span> wait, wut?
<a name="l-325"></a><span class="tm">19:45:45</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">wumpus:</span> yes, see cory's code in 8680, can easily adopt all wallet calls to use that (or ask the wallet for its height but then they might have to poll) and weight until it hits what chainactive was at the start of the call
<a name="l-326"></a><span class="tm">19:46:00</span><span class="nk"> &lt;BlueMatt&gt;</span> the proposal is that rpc calls might block until the wallet has caught up to where main chainstate is
<a name="l-327"></a><span class="tm">19:46:03</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">gmaxwell:</span> yeah i think you're misunderstanding
<a name="l-328"></a><span class="tm">19:46:10</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">morcos:</span> yup... but at some point we'd want to get rid of that too, i think
<a name="l-329"></a><span class="tm">19:46:13</span><span class="nk"> &lt;BlueMatt&gt;</span> the wallet processing can still be in a background thread, or on the main thread, or whatever
<a name="l-330"></a><span class="tm">19:46:17</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">morcos:</span> yes, that makes sense
<a name="l-331"></a><span class="tm">19:46:19</span><span class="nk"> &lt;gmaxwell&gt;</span> and I think it's insane to degrade concurrency for an obscure property that anyone who wants can retain by using an appropritate call to ask where the wallet is vs where the blockchain is.
<a name="l-332"></a><span class="tm">19:46:20</span><span class="nk"> &lt;BlueMatt&gt;</span> it just has to catch up before the rpc will return
<a name="l-333"></a><span class="tm">19:46:37</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">gmaxwell:</span> we arent degregading concurrency except that rpc calls might block, afaict
<a name="l-334"></a><span class="tm">19:46:46</span><span class="nk"> &lt;BlueMatt&gt;</span> and then we're returning more up-to-date info anyway
<a name="l-335"></a><span class="tm">19:46:50</span><span class="nk"> &lt;BlueMatt&gt;</span> so thats not even so bad
<a name="l-336"></a><span class="tm">19:46:57</span><span class="nk"> &lt;morcos&gt;</span> might block but would still return before they would have in 0.13!!!
<a name="l-337"></a><span class="tm">19:47:01</span><span class="nk"> &lt;cfields&gt;</span> <span class="hi">BlueMatt:</span> and it only blocks as long sa it would've before
<a name="l-338"></a><span class="tm">19:47:08</span><span class="nk"> &lt;BlueMatt&gt;</span> true
<a name="l-339"></a><span class="tm">19:47:38</span><span class="nk"> &lt;gmaxwell&gt;</span> what was suggested above was the block processing taking the wallet lock; which would bidirectionally block each other.
<a name="l-340"></a><span class="tm">19:47:48</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">gmaxwell:</span> no
<a name="l-341"></a><span class="tm">19:47:52</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">gmaxwell:</span> that was a proposal to solve problem 2 (the mid block)
<a name="l-342"></a><span class="tm">19:47:54</span><span class="nk"> &lt;BlueMatt&gt;</span> that was to a different issue
<a name="l-343"></a><span class="tm">19:47:57</span><span class="nk"> &lt;BlueMatt&gt;</span> there are two issues
<a name="l-344"></a><span class="tm">19:48:01</span><span class="nk"> &lt;BlueMatt&gt;</span> well, potential issues
<a name="l-345"></a><span class="tm">19:48:12</span><span class="nk"> &lt;sipa&gt;</span> the proposal was that _the wallet_ would grab _the wallet lock_ while it was updating its state for a new block
<a name="l-346"></a><span class="tm">19:48:25</span><span class="nk"> &lt;morcos&gt;</span> that problem needs more investigation to determine a) whether it needs solving and b) whether there is a simple solution.  i agree with your objection to my first suggested solution
<a name="l-347"></a><span class="tm">19:49:15</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">sipa:</span> yes but thats only a good idea when thats not running in teh same thread as block processing in the middle of block processing, otherwise some other independent wallet call holds up block processing
<a name="l-348"></a><span class="tm">19:49:17</span><span class="nk"> &lt;sipa&gt;</span> are there other topics? i don't think we need to figure this out completely right now
<a name="l-349"></a><span class="tm">19:49:20</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">morcos:</span> Sounds fine to me.
<a name="l-350"></a><span class="tm">19:49:21</span><span class="nk"> &lt;wumpus&gt;</span> I think it's better to take this outside the meeting. Any other topics?
<a name="l-351"></a><span class="tm">19:49:28</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">wumpus:</span> ha , too late!
<a name="l-352"></a><span class="tm">19:49:48</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">morcos:</span> heh same idea
<a name="l-353"></a><span class="tm">19:50:00</span><span class="nk"> &lt;cfields&gt;</span> this can be handled with signals btw, no need to grab actual locks. StartProcessing() -&gt; block rpc -&gt; FinishedProcessing() unblock
<a name="l-354"></a><span class="tm">19:50:36</span><span class="nk"> &lt;cfields&gt;</span> yes, later is fine. That got more heated than I expected :)
<a name="l-355"></a><span class="tm">19:50:59</span><span class="nk"> &lt;cfields&gt;</span> though, we still have the question of what to do about the tests.
<a name="l-356"></a><span class="tm">19:51:13</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">morcos:</span> yes, i'm not saying that's what we should or shouldn't do... just clarifying what the idea was
<a name="l-357"></a><span class="tm">19:51:14</span><span class="nk"> &lt;morcos&gt;</span> does 8680 fix the tests or not really?
<a name="l-358"></a><span class="tm">19:51:26</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">cfields:</span> I think your pull is fine for that, as a temp fix at least
<a name="l-359"></a><span class="tm">19:51:28</span><span class="nk"> &lt;morcos&gt;</span> i think 8680 seems reasonable to me
<a name="l-360"></a><span class="tm">19:51:33</span><span class="nk"> &lt;wumpus&gt;</span> right
<a name="l-361"></a><span class="tm">19:51:39</span><span class="nk"> &lt;sipa&gt;</span> let's merge 8680 to fix the annoyance with the test
<a name="l-362"></a><span class="tm">19:51:42</span><span class="nk"> &lt;cfields&gt;</span> <span class="hi">morcos:</span> i believe so, but not 100% because of the nature
<a name="l-363"></a><span class="tm">19:51:47</span><span class="nk"> &lt;sipa&gt;</span> but open a tracker issue to reconsider
<a name="l-364"></a><span class="tm">19:51:52</span><span class="nk"> &lt;cfields&gt;</span> (i'm not 100%, sorry)
<a name="l-365"></a><span class="tm">19:51:53</span><span class="nk"> &lt;wumpus&gt;</span> <span class="cmd">#action </span><span class="cmdline">merge  8680 to fix the annoyance with the test</span>
<a name="l-366"></a><span class="tm">19:51:54</span><span class="nk"> &lt;michagogo&gt;</span> &lt;i&gt;8m warning&lt;/i&gt;
<a name="l-367"></a><span class="tm">19:52:14</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">michagogo:</span> looks like we're out of topics sooner than out of time
<a name="l-368"></a><span class="tm">19:52:19</span><span class="nk"> &lt;cfields&gt;</span> ok, I can slim that down to only the rpc used by the tests then
<a name="l-369"></a><span class="tm">19:52:25</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">cfields:</span> ack
<a name="l-370"></a><span class="tm">19:52:33</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">cfields:</span> thanks
<a name="l-371"></a><span class="tm">19:52:49</span><span class="nk"> &lt;wumpus&gt;</span> <span class="cmd">#endmeeting</span><span class="cmdline"></span></pre>
</body></html>
