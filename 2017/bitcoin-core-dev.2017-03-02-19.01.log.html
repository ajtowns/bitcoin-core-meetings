<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<title>#bitcoin-core-dev log</title>
<style type="text/css">
/* For the .log.html */
pre { /*line-height: 125%;*/
      white-space: pre-wrap; }
body { background: #f0f0f0; }

body .tm  { color: #007020 }                      /* time */
body .nk  { color: #062873; font-weight: bold }   /* nick, regular */
body .nka { color: #007020; font-weight: bold }  /* action nick */
body .ac  { color: #00A000 }                      /* action line */
body .hi  { color: #4070a0 }                 /* hilights */
/* Things to make particular MeetBot commands stick out */
body .topic     { color: #007020; font-weight: bold }
body .topicline { color: #000080; font-weight: bold }
body .cmd       { color: #007020; font-weight: bold }
body .cmdline  { font-weight: bold }

</style>
</head>

<body>
<pre><a name="l-1"></a><span class="tm">19:01:32</span><span class="nk"> &lt;wumpus&gt;</span> <span class="cmd">#startmeeting</span><span class="cmdline"></span>
<a name="l-2"></a><span class="tm">19:01:32</span><span class="nk"> &lt;lightningbot&gt;</span> Meeting started Thu Mar  2 19:01:32 2017 UTC.  The chair is wumpus. Information about MeetBot at http://wiki.debian.org/MeetBot.
<a name="l-3"></a><span class="tm">19:01:32</span><span class="nk"> &lt;lightningbot&gt;</span> Useful Commands: #action #agreed #help #info #idea #link #topic.
<a name="l-4"></a><span class="tm">19:02:02</span><span class="nk"> &lt;wumpus&gt;</span> <span class="cmd">#bitcoin-core-dev </span><span class="cmdline">Meeting: wumpus sipa gmaxwell jonasschnelli morcos luke-jr btcdrak sdaftuar jtimon cfields petertodd kanzure bluematt</span>
<a name="l-5"></a><span class="tm">19:02:02</span><span class="nk"> &lt;wumpus&gt;</span> instagibbs phantomcircuit codeshark michagogo marcofalke paveljanik NicolasDorier jl2012 instagibbs
<a name="l-6"></a><span class="tm">19:02:08</span><span class="nk"> &lt;sdaftuar&gt;</span> hi
<a name="l-7"></a><span class="tm">19:02:09</span><span class="nk"> &lt;kanzure&gt;</span> hi.
<a name="l-8"></a><span class="tm">19:02:23</span><span class="nk"> &lt;BlueMatt&gt;</span> topics?
<a name="l-9"></a><span class="tm">19:02:48 </span><span class="nka">* BlueMatt</span> <span class="ac">would like to discuss the lack of unicorns 'round here</span>
<a name="l-10"></a><span class="tm">19:03:01</span><span class="nk"> &lt;sdaftuar&gt;</span> topic suggestion: any open items for 0.14?
<a name="l-11"></a><span class="tm">19:03:08</span><span class="nk"> &lt;wumpus&gt;</span> <span class="hi">BlueMatt:</span> +1
<a name="l-12"></a><span class="tm">19:03:34</span><span class="nk"> &lt;wumpus&gt;</span> any new issues with rc3?
<a name="l-13"></a><span class="tm">19:04:16</span><span class="nk"> &lt;gmaxwell&gt;</span> I have an issue.
<a name="l-14"></a><span class="tm">19:04:40</span><span class="nk"> &lt;gmaxwell&gt;</span> It isn't released yet. :P
<a name="l-15"></a><span class="tm">19:04:46</span><span class="nk"> &lt;sipa&gt;</span> ha.
<a name="l-16"></a><span class="tm">19:05:01</span><span class="nk"> &lt;wumpus&gt;</span> hehe
<a name="l-17"></a><span class="tm">19:05:09</span><span class="nk"> &lt;BlueMatt&gt;</span> yup
<a name="l-18"></a><span class="tm">19:05:39</span><span class="nk"> &lt;BlueMatt&gt;</span> rc3 was posted yesterday, so release is next tuesday if nothing else comes up, I believe?
<a name="l-19"></a><span class="tm">19:06:17</span><span class="nk"> &lt;sipa&gt;</span> seems reasonable
<a name="l-20"></a><span class="tm">19:06:24</span><span class="nk"> &lt;gmaxwell&gt;</span> I saw some positive comments on Bitcoin talk.
<a name="l-21"></a><span class="tm">19:06:30</span><span class="nk"> &lt;BlueMatt&gt;</span> dont we normally do a week after rc?
<a name="l-22"></a><span class="tm">19:06:38</span><span class="nk"> &lt;wumpus&gt;</span> yup, that's how it useually goes yes, BlueMatt
<a name="l-23"></a><span class="tm">19:08:07</span><span class="nk"> &lt;MarcoFalke&gt;</span> <span class="cmd">#action </span><span class="cmdline">plan to release next tuesday if nothing else comes up</span>
<a name="l-24"></a><span class="tm">19:08:38</span><span class="nk"> &lt;morcos&gt;</span> i'd like to briefly discuss the timing of merging #9602..  b/c assuming we are going to do it, it would be nice to get it out of the way so its not a rebase/review nightmare.  i also have a ton of fee estimation changes built on top
<a name="l-25"></a><span class="tm">19:08:42</span><span class="nk"> &lt;gribble&gt;</span> https://github.com/bitcoin/bitcoin/issues/9602 | Remove coin age priority and free transactions - implementation by morcos · Pull Request #9602 · bitcoin/bitcoin · GitHub
<a name="l-26"></a><span class="tm">19:08:58</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">morcos:</span> will finish review soon, but so far lgtm
<a name="l-27"></a><span class="tm">19:09:05</span><span class="nk"> &lt;BlueMatt&gt;</span> would agree it should merge fast
<a name="l-28"></a><span class="tm">19:09:25</span><span class="nk"> &lt;wumpus&gt;</span> <span class="topic">#topic </span><span class="topicline">discuss the timing of merging #9602</span>
<a name="l-29"></a><span class="tm">19:09:27</span><span class="nk"> &lt;gribble&gt;</span> https://github.com/bitcoin/bitcoin/issues/9602 | Remove coin age priority and free transactions - implementation by morcos · Pull Request #9602 · bitcoin/bitcoin · GitHub
<a name="l-30"></a><span class="tm">19:09:37</span><span class="nk"> &lt;sdaftuar&gt;</span> +1 for merging sooner rather than later
<a name="l-31"></a><span class="tm">19:10:22</span><span class="nk"> &lt;wumpus&gt;</span> well if it is ready for merge it should be merged
<a name="l-32"></a><span class="tm">19:10:22</span><span class="nk"> &lt;sdaftuar&gt;</span> i'm also working on some mining tweaks that i'd rather just build on top of 9602
<a name="l-33"></a><span class="tm">19:10:48</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">wumpus:</span> I believe it needs review and morcos is asking for fast-review because its a pita to rebase constantly
<a name="l-34"></a><span class="tm">19:11:04</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">wumpus:</span> oh ok, i just wanted to coordinate so people were reviewing at the same time frame... thats when the rebases get annoying, when ppl have reviewed different versions.  and now it seems people have started reviewing
<a name="l-35"></a><span class="tm">19:11:13</span><span class="nk"> &lt;morcos&gt;</span> so anyone else that is interested, sooner is better than later
<a name="l-36"></a><span class="tm">19:11:30</span><span class="nk"> &lt;gmaxwell&gt;</span> Sounds fine to me, a related subject is that there are a number of other features (like multiwallet) that just missed 0.14 which we should try to get in early rather than later.
<a name="l-37"></a><span class="tm">19:12:04</span><span class="nk"> &lt;wumpus&gt;</span> yes
<a name="l-38"></a><span class="tm">19:12:22</span><span class="nk"> &lt;BlueMatt&gt;</span> yes, I imagine luke's dont-use-pwalletMin thing is a pita to rebase as well
<a name="l-39"></a><span class="tm">19:13:06</span><span class="nk"> &lt;BlueMatt&gt;</span> that would be #8775
<a name="l-40"></a><span class="tm">19:13:09</span><span class="nk"> &lt;gribble&gt;</span> https://github.com/bitcoin/bitcoin/issues/8775 | RPC refactoring: Access wallet using new GetWalletForJSONRPCRequest by luke-jr · Pull Request #8775 · bitcoin/bitcoin · GitHub
<a name="l-41"></a><span class="tm">19:13:18</span><span class="nk"> &lt;gmaxwell&gt;</span> it's also an issue that if these things drag on until late in the cycle they'll miss again.
<a name="l-42"></a><span class="tm">19:14:04</span><span class="nk"> &lt;wumpus&gt;</span> right, so all review multiwallet pulls
<a name="l-43"></a><span class="tm">19:14:48</span><span class="nk"> &lt;wumpus&gt;</span> <span class="cmd">#8775 </span><span class="cmdline">should probably go in first</span>
<a name="l-44"></a><span class="tm">19:14:51</span><span class="nk"> &lt;gribble&gt;</span> https://github.com/bitcoin/bitcoin/issues/8775 | RPC refactoring: Access wallet using new GetWalletForJSONRPCRequest by luke-jr · Pull Request #8775 · bitcoin/bitcoin · GitHub
<a name="l-45"></a><span class="tm">19:15:13</span><span class="nk"> &lt;MarcoFalke&gt;</span> They don't conflict according to git merge, so no strict order required
<a name="l-46"></a><span class="tm">19:15:18</span><span class="nk"> &lt;gmaxwell&gt;</span> It might be useful, not in this meeting, but for people to think about what they'd like the big features of 0.15 to be and make sure we make progress early enough on those things so that they can actually be there. :) I feel like there were things that at least I personally wanted in 0.14 but didn't give them enough attention until too late.
<a name="l-47"></a><span class="tm">19:16:02</span><span class="nk"> &lt;morcos&gt;</span> 1 major feature thats in the back of my mind, but a bit complicated so might require some discussion as to whether we want it and when is automated fee-bumping
<a name="l-48"></a><span class="tm">19:16:40</span><span class="nk"> &lt;wumpus&gt;</span> well at least there should be time for features again in 0.15. 0.14 time was mostly spent on segwit
<a name="l-49"></a><span class="tm">19:16:53</span><span class="nk"> &lt;sipa&gt;</span> famous last words :)
<a name="l-50"></a><span class="tm">19:16:56</span><span class="nk"> &lt;sipa&gt;</span> but i agree
<a name="l-51"></a><span class="tm">19:17:23</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">morcos:</span> I would replace 'automated fee bumping' with 'precomputed fee bumping'  E.g. when you sign, presign all the bumps, locktimed... so they don't interfear with the wallet encryption.. and could even be handed off to someone if you go offline.
<a name="l-52"></a><span class="tm">19:17:29</span><span class="nk"> &lt;wumpus&gt;</span> well I don't know of any large upcoming softfork projects monopolizing everyone at least?
<a name="l-53"></a><span class="tm">19:17:45</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">wumpus:</span> everything like that is on hold for segwit!
<a name="l-54"></a><span class="tm">19:18:03</span><span class="nk"> &lt;wumpus&gt;</span> so hopefully for 0.16 again then :)
<a name="l-55"></a><span class="tm">19:18:33</span><span class="nk"> &lt;wumpus&gt;</span> anyhow, it means for 0.15 we can focus on software features instead of network/consensus features
<a name="l-56"></a><span class="tm">19:18:37</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">gmaxwell:</span> do we not have any suggested SF's that aren't built off segwit in the queue?  lets take advantage of BIP 9!
<a name="l-57"></a><span class="tm">19:19:11</span><span class="nk"> &lt;sipa&gt;</span> raise min difficulty, optional utxo commitments, ...
<a name="l-58"></a><span class="tm">19:19:12</span><span class="nk"> &lt;gmaxwell&gt;</span> on that subject, we should reconsider some things around how segwit works: that we won't mine once segwit is active without the flag set,  and we don't set the versionbit without the flag... Both of these are foolish IMO.
<a name="l-59"></a><span class="tm">19:20:34</span><span class="nk"> &lt;sipa&gt;</span> oh, by flag you mean whether the GBT client indicates support?
<a name="l-60"></a><span class="tm">19:20:45</span><span class="nk"> &lt;gmaxwell&gt;</span> by 'don't set the versionbit without the flag-- if the GBT client doesn't signal segwit support we don't set the BIP 9 bit. Which is stupid, since we'll happily enforce the rules.
<a name="l-61"></a><span class="tm">19:20:48</span><span class="nk"> &lt;sdaftuar&gt;</span> we do that so that segwit can't activate without the miners actually mining segwit transactions
<a name="l-62"></a><span class="tm">19:20:59</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">sdaftuar:</span> I'm not too worried about that
<a name="l-63"></a><span class="tm">19:21:19</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">sdaftuar:</span> yea but I think that is an error. So what if they don't? Then there is just less capacity for segwit txn initially until they upgrade, and they'll lose out on fees.
<a name="l-64"></a><span class="tm">19:21:27</span><span class="nk"> &lt;BlueMatt&gt;</span> I prefer for miners to be able to mine and just lose out on fee revenue than stop mining
<a name="l-65"></a><span class="tm">19:21:44</span><span class="nk"> &lt;wumpus&gt;</span> <span class="cmd">#action </span><span class="cmdline">review and merge #8775 and #9602 as soon as possible, they are prone to turning into rebase/merge nightmares</span>
<a name="l-66"></a><span class="tm">19:21:47</span><span class="nk"> &lt;gribble&gt;</span> https://github.com/bitcoin/bitcoin/issues/8775 | RPC refactoring: Access wallet using new GetWalletForJSONRPCRequest by luke-jr · Pull Request #8775 · bitcoin/bitcoin · GitHub
<a name="l-67"></a><span class="tm">19:21:49</span><span class="nk"> &lt;gribble&gt;</span> https://github.com/bitcoin/bitcoin/issues/9602 | Remove coin age priority and free transactions - implementation by morcos · Pull Request #9602 · bitcoin/bitcoin · GitHub
<a name="l-68"></a><span class="tm">19:21:54</span><span class="nk"> &lt;sdaftuar&gt;</span> <span class="hi">gmaxwell:</span> my concern (before we got to the point we're at now) was that segwit could have activated with 0 miners mining
<a name="l-69"></a><span class="tm">19:22:00</span><span class="nk"> &lt;sdaftuar&gt;</span> and then mempools could be attacekd with transactions that wouldn't confirm
<a name="l-70"></a><span class="tm">19:22:05</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">gmaxwell:</span> agreed, as long as we know that SOME miners are mining them..  which seems we're at that poin tnow
<a name="l-71"></a><span class="tm">19:22:05</span><span class="nk"> &lt;sdaftuar&gt;</span> perhaps now we can relax it
<a name="l-72"></a><span class="tm">19:22:07</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">sdaftuar:</span> Yes, I agree. That would be silly. But we're not there now. :)
<a name="l-73"></a><span class="tm">19:22:34</span><span class="nk"> &lt;gmaxwell&gt;</span> I didn't protest at the time because of that. (well actually on the stops mining thing, I thought we fixed that)
<a name="l-74"></a><span class="tm">19:22:52</span><span class="nk"> &lt;sipa&gt;</span> suggested topic: CNB calling TBV or not, and CNB caching
<a name="l-75"></a><span class="tm">19:23:12</span><span class="nk"> &lt;gmaxwell&gt;</span> (My misunderstanding was that I thought we stopped mining without the gbt-flag entirely once the code had support for it.. and I saw that wasn't the case)
<a name="l-76"></a><span class="tm">19:24:07</span><span class="nk"> &lt;gmaxwell&gt;</span> We need to get TBV out of the critical path. I do not really agree with lightswords view on it though-- I think it's important that we have some process that tests that blocks were handing out to mine. It does not need to be in the critical path.
<a name="l-77"></a><span class="tm">19:24:41</span><span class="nk"> &lt;wumpus&gt;</span> <span class="topic">#topic </span><span class="topicline">CNB calling TBV or not, and CNB caching</span>
<a name="l-78"></a><span class="tm">19:24:45</span><span class="nk"> &lt;sipa&gt;</span> i believe that what the code does for an actual miners doesn't matter
<a name="l-79"></a><span class="tm">19:24:53</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">gmaxwell:</span> sipa: i think the downside of leaving it in the critical path is an extra 150ms of mining with an empty block
<a name="l-80"></a><span class="tm">19:25:00</span><span class="nk"> &lt;sipa&gt;</span> yes, that's obvious
<a name="l-81"></a><span class="tm">19:25:05</span><span class="nk"> &lt;sipa&gt;</span> and there are various solutions
<a name="l-82"></a><span class="tm">19:25:08</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">morcos:</span> or worse.
<a name="l-83"></a><span class="tm">19:25:12</span><span class="nk"> &lt;sipa&gt;</span> an easy one (just get rid of the test)
<a name="l-84"></a><span class="tm">19:25:22</span><span class="nk"> &lt;sipa&gt;</span> or a hard one (background validation, caching, ...)
<a name="l-85"></a><span class="tm">19:25:46</span><span class="nk"> &lt;gmaxwell&gt;</span> The challenge with backgrounding it is that test holds cs_main for a long time.
<a name="l-86"></a><span class="tm">19:25:55</span><span class="nk"> &lt;morcos&gt;</span> hmm, i guess i was wrong
<a name="l-87"></a><span class="tm">19:25:55</span><span class="nk"> &lt;gmaxwell&gt;</span> I have suggested making the validation it does interruptable.
<a name="l-88"></a><span class="tm">19:26:15</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">gmaxwell:</span> I have suggested that many times :)
<a name="l-89"></a><span class="tm">19:26:17</span><span class="nk"> &lt;morcos&gt;</span> if you want to build on a prior header, you can't have TBV in the critical path, b/c you might not be even able to do it if you dont' have prior block
<a name="l-90"></a><span class="tm">19:26:33</span><span class="nk"> &lt;gmaxwell&gt;</span> E.g. an atomic checked between each transaction which can abort a test validation. This would also be useful for the block proposal validations.
<a name="l-91"></a><span class="tm">19:27:00</span><span class="nk"> &lt;gmaxwell&gt;</span> then an incoming block will set the atomic and then block on acquiring cs_main.
<a name="l-92"></a><span class="tm">19:27:08</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">morcos:</span> well building on a prior header is easy... i'm sure we can build an empty block that's valid
<a name="l-93"></a><span class="tm">19:27:30</span><span class="nk"> &lt;gmaxwell&gt;</span> the background thread would just go to sleep and try again later. Block proposals would just sleep for a bit then try again (while the RPC caller waited)
<a name="l-94"></a><span class="tm">19:27:45</span><span class="nk"> &lt;morcos&gt;</span> yes but we have to have a way of skipping TBV on that block don't we? or some really hacking version that calls TBV on a fake chain active
<a name="l-95"></a><span class="tm">19:28:38</span><span class="nk"> &lt;sipa&gt;</span> an alternative is just having a background process that every so often runs CNB and caches the result
<a name="l-96"></a><span class="tm">19:28:47</span><span class="nk"> &lt;sipa&gt;</span> and then validates it after storing in the cache
<a name="l-97"></a><span class="tm">19:28:56</span><span class="nk"> &lt;gmaxwell&gt;</span> Well my thought would be we'd just have a background loop, running even if you don't mine, that TBVs once a minute or so.. and it can get interrupted. and if its interrupted it just gives up until the next minute.
<a name="l-98"></a><span class="tm">19:29:03</span><span class="nk"> &lt;morcos&gt;</span> it only needs to be out of the criticial path when there is a new tip... when its just updating the block, it doesn't matter if you wait for it
<a name="l-99"></a><span class="tm">19:29:04</span><span class="nk"> &lt;sipa&gt;</span> then GBT can check whether the cached block still builds on top of the best header, and if not, return an empty block
<a name="l-100"></a><span class="tm">19:29:24</span><span class="nk"> &lt;gmaxwell&gt;</span> okay if doing what sipa suggests a minute is a bit slow!
<a name="l-101"></a><span class="tm">19:29:40</span><span class="nk"> &lt;sipa&gt;</span> and a new tip would obviously wake the background thread
<a name="l-102"></a><span class="tm">19:29:50</span><span class="nk"> &lt;gmaxwell&gt;</span> but sounds like we were thinking of similar-ish things.
<a name="l-103"></a><span class="tm">19:30:08</span><span class="nk"> &lt;sipa&gt;</span> however, we wouldn't want such a background CNB for normal nodes
<a name="l-104"></a><span class="tm">19:30:26</span><span class="nk"> &lt;gmaxwell&gt;</span> I dunno, at a low enough frequency it would be fine and would create a lot more in-field testing.
<a name="l-105"></a><span class="tm">19:30:36</span><span class="nk"> &lt;morcos&gt;</span> the good thing about going down that road is you can be smarter about waking the CNB thread to wait until you have new high fee txs that are at least n seconds old or what have you
<a name="l-106"></a><span class="tm">19:30:52</span><span class="nk"> &lt;sdaftuar&gt;</span> <span class="hi">morcos:</span> are you going to PR something that calls CNB to keep pcoinsTip warm?
<a name="l-107"></a><span class="tm">19:31:00</span><span class="nk"> &lt;sipa&gt;</span> and it would keep the sigcache warm with what we expect to be mined
<a name="l-108"></a><span class="tm">19:31:01</span><span class="nk"> &lt;morcos&gt;</span> running TBV on slow hardware over and over is probably bad
<a name="l-109"></a><span class="tm">19:31:16</span><span class="nk"> &lt;gmaxwell&gt;</span> One thing I suggested previously is that calling GBT pump the refresh of the cache... so it runs more often if you're calling GBT than otherwise.
<a name="l-110"></a><span class="tm">19:31:31</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">gmaxwell:</span> seems reasonable
<a name="l-111"></a><span class="tm">19:31:41</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">sdaftuar:</span> i don't remember....   but i think the version i had, only ran it once after a flush
<a name="l-112"></a><span class="tm">19:31:54</span><span class="nk"> &lt;sipa&gt;</span> this not only takes TBV out of the critical path, but also CNB
<a name="l-113"></a><span class="tm">19:31:55</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">morcos:</span> once a minute? it wouldn't be horrible. Once every 10 minutes? 20 minutes?  I think there is a number where its harmless and we would avoid having code that runs only on a very small number of nodes thus gets inadequate operaiton to expose bugs.
<a name="l-114"></a><span class="tm">19:32:36</span><span class="nk"> &lt;morcos&gt;</span> honestly i think a more important direction to go would be to start by replacing GBT with a better framework
<a name="l-115"></a><span class="tm">19:32:40</span><span class="nk"> &lt;morcos&gt;</span> and then making that work optimally
<a name="l-116"></a><span class="tm">19:32:48</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">morcos:</span> i think this may be orthogonal work
<a name="l-117"></a><span class="tm">19:32:56</span><span class="nk"> &lt;gmaxwell&gt;</span> I think this is more or less orthorgonal to GBT. In that anything else will still need to create a block template. :)
<a name="l-118"></a><span class="tm">19:32:57</span><span class="nk"> &lt;sipa&gt;</span> it'd just be a wrapper around CNB
<a name="l-119"></a><span class="tm">19:33:21</span><span class="nk"> &lt;morcos&gt;</span> i agree its mostly orthogonal.. but one still probably has to occupy our attention first
<a name="l-120"></a><span class="tm">19:33:42</span><span class="nk"> &lt;sipa&gt;</span> well GBT replacement needs a lot of external discussion
<a name="l-121"></a><span class="tm">19:33:50</span><span class="nk"> &lt;gmaxwell&gt;</span> Well there are design considerations in the 'better thing' that hinge really on how fast CNB is ... and the spectrum of options we want to hand out when we can't give an answer fast.
<a name="l-122"></a><span class="tm">19:35:06</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">gmaxwell:</span> hmm.. yes... perhaps what i mean is we should design the better thing so it informs what we want out of CNB/TBV.  and document the design so we dont' forget..  even if we don't do it yet
<a name="l-123"></a><span class="tm">19:36:02</span><span class="nk"> &lt;gmaxwell&gt;</span> I think right now I don't have a lot of appetite for major inititavies that we can't just do within the project. But if someone wants to undertake a big coordination effort, that shouldn't slow them down.
<a name="l-124"></a><span class="tm">19:36:13</span><span class="nk"> &lt;gmaxwell&gt;</span> Okay, well an expirement is not something we need permission for... :)
<a name="l-125"></a><span class="tm">19:36:41</span><span class="nk"> &lt;morcos&gt;</span> ok no argument here
<a name="l-126"></a><span class="tm">19:37:08</span><span class="nk"> &lt;morcos&gt;</span> i guess this all hinges on making the TBV code (and maybe even CNB) interruptible
<a name="l-127"></a><span class="tm">19:37:19</span><span class="nk"> &lt;sipa&gt;</span> i think that's relatively easy
<a name="l-128"></a><span class="tm">19:38:45</span><span class="nk"> &lt;morcos&gt;</span> yeah thinking about it, they both are pretty trivial
<a name="l-129"></a><span class="tm">19:39:20</span><span class="nk"> &lt;gmaxwell&gt;</span> Tightly related to this question is the question of bypassing validation for things in our template. As you may be aware some people have been using in-mempoolness as a proxy for validity. This seems rather sketchy to me, though it should be a pretty substantial latency improvement.  The assumption that makes ditching TBV okay also makes doing that okay, I believe.  And there is an open alternat
<a name="l-130"></a><span class="tm">19:39:26</span><span class="nk"> &lt;gmaxwell&gt;</span> ive which is potentially more safe, if a transaction is in our template cache for this height, which we've already verified, then its validation could be skipped.
<a name="l-131"></a><span class="tm">19:40:18</span><span class="nk"> &lt;morcos&gt;</span> i'm basically opposed to that
<a name="l-132"></a><span class="tm">19:40:55</span><span class="nk"> &lt;sipa&gt;</span> relying on the template-validation-cache to be correct seems less risky than relying on the mempool itself to be correct
<a name="l-133"></a><span class="tm">19:41:03</span><span class="nk"> &lt;gmaxwell&gt;</span> And if it results in users not using this software but software written by people who don't even know enough to oppose that?
<a name="l-134"></a><span class="tm">19:41:07</span><span class="nk"> &lt;sipa&gt;</span> but it does make TBV consensus critical
<a name="l-135"></a><span class="tm">19:41:09</span><span class="nk"> &lt;morcos&gt;</span> i do think we could do these things while waiting for validation
<a name="l-136"></a><span class="tm">19:41:18</span><span class="nk"> &lt;gmaxwell&gt;</span> In any case, just a thought.
<a name="l-137"></a><span class="tm">19:41:25</span><span class="nk"> &lt;luke-jr&gt;</span> TBV is already consensus-critical, more or less
<a name="l-138"></a><span class="tm">19:41:30</span><span class="nk"> &lt;luke-jr&gt;</span> the code for it anyhow
<a name="l-139"></a><span class="tm">19:41:33</span><span class="nk"> &lt;gmaxwell&gt;</span> (that using a tested template is safer than the mempool)
<a name="l-140"></a><span class="tm">19:41:58</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">luke-jr:</span> well it uses most of ConnectBlock, which definitely is consensus critical
<a name="l-141"></a><span class="tm">19:42:03</span><span class="nk"> &lt;morcos&gt;</span> e.g.  get a new block from the network... -&gt; assume valid -&gt; mark all txs in mempool as potentially used -&gt; CNB from remaining -&gt; have not yet validated new tip or TBV new template, and if we find a block, so be it...
<a name="l-142"></a><span class="tm">19:42:04</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">luke-jr:</span> that overlap is what makes it less risky
<a name="l-143"></a><span class="tm">19:42:27</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">morcos:</span> that is also interesting.
<a name="l-144"></a><span class="tm">19:42:35</span><span class="nk"> &lt;gmaxwell&gt;</span> so fast for mining but nothing else.
<a name="l-145"></a><span class="tm">19:42:38</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">gmaxwell:</span> i guess its not QUITE that easy
<a name="l-146"></a><span class="tm">19:43:10</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">morcos:</span> but in that case you would extend an invalid block, bad.
<a name="l-147"></a><span class="tm">19:43:45</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">gmaxwell:</span> yes but only for a couple hundred ms...  you still immediately validate and switch work if there was a problem
<a name="l-148"></a><span class="tm">19:44:04</span><span class="nk"> &lt;gmaxwell&gt;</span> (very bad to have miners extending invalid blocks, even for relatively brief intervals, massively amplifies risk for lite clients-- especially since devices may stay on old work for tens of seconds)
<a name="l-149"></a><span class="tm">19:44:22</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">plan:</span> 1) make TBV interruptible 2) add background thread that caches CNB results 3) make GBT return an empty block if the cache does not build on your tip
<a name="l-150"></a><span class="tm">19:44:27</span><span class="nk"> &lt;gmaxwell&gt;</span> (and I got flamed to death when I suggested a singaling mechenism for lite clients to ignore confirmations constructed that way)
<a name="l-151"></a><span class="tm">19:44:45</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">sipa:</span> that plan sounds good.
<a name="l-152"></a><span class="tm">19:44:51</span><span class="nk"> &lt;morcos&gt;</span> well we can't make our plans based on what you get flamed for can we?  :)
<a name="l-153"></a><span class="tm">19:44:56</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">gmaxwell:</span> I'm more a fan of not relying on validation being fast - mine empty blocks for the 100ms it takes to get a blocktemplate, and relay blocks during validation
<a name="l-154"></a><span class="tm">19:44:58</span><span class="nk"> &lt;BlueMatt&gt;</span> problem solved :)
<a name="l-155"></a><span class="tm">19:45:03</span><span class="nk"> &lt;sipa&gt;</span> agree
<a name="l-156"></a><span class="tm">19:45:34</span><span class="nk"> &lt;sipa&gt;</span> where did you get flamed?
<a name="l-157"></a><span class="tm">19:45:38</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">BlueMatt:</span> you still need to validate a block before extending it. To not do so is toxic to lite clients which strongly trust that you have.
<a name="l-158"></a><span class="tm">19:45:41</span><span class="nk"> &lt;gmaxwell&gt;</span> bitcoin-dev
<a name="l-159"></a><span class="tm">19:45:53</span><span class="nk"> &lt;morcos&gt;</span> <span class="hi">sipa:</span> ha ha ha, that was a funny
<a name="l-160"></a><span class="tm">19:46:22</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">gmaxwell:</span> oh? every time I've discussed it with anyone in person they're like "yea, do that, sounds good" :)
<a name="l-161"></a><span class="tm">19:46:28</span><span class="nk"> &lt;gmaxwell&gt;</span> I wrote a spec for signaling that you've not validated the prior block. So that lite clients could just ignore those blocks as confirmations.
<a name="l-162"></a><span class="tm">19:46:43</span><span class="nk"> &lt;sipa&gt;</span> <span class="hi">morcos:</span> it was an honest question - i can remember gmaxwell bringing it up in here a few times, i didn't know there was more to it
<a name="l-163"></a><span class="tm">19:47:24</span><span class="nk"> &lt;gmaxwell&gt;</span> I wrote a BIP, draft-maxwell-flagverify
<a name="l-164"></a><span class="tm">19:47:24</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">gmaxwell:</span> and I think we should implement that when we go to return empty blocks :)
<a name="l-165"></a><span class="tm">19:47:33</span><span class="nk"> &lt;BlueMatt&gt;</span> I'm happy to go implement it in lite clients, too
<a name="l-166"></a><span class="tm">19:49:26</span><span class="nk"> &lt;gmaxwell&gt;</span> I also think the rise in fees is such that it's increasingly less interesting to produce empty blocks.
<a name="l-167"></a><span class="tm">19:50:03</span><span class="nk"> &lt;BlueMatt&gt;</span> true, but 12.5 BTC is sitll &gt; 0 BTC :P
<a name="l-168"></a><span class="tm">19:50:05</span><span class="nk"> &lt;luke-jr&gt;</span> should GBT return partial blocks, as the background thread fills it?
<a name="l-169"></a><span class="tm">19:50:15</span><span class="nk"> &lt;gmaxwell&gt;</span> lightsword isn't here now it seems but previously he has pointed out that returning an empty template is often bad because the downstream software stack doesn't know to try again immediately and so will mine on it for a long time.
<a name="l-170"></a><span class="tm">19:50:22</span><span class="nk"> &lt;BlueMatt&gt;</span> there is just more pressure to limit the time you're spending mining empty blocks :)
<a name="l-171"></a><span class="tm">19:50:43</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">Lightsword:</span> yes he is
<a name="l-172"></a><span class="tm">19:51:11</span><span class="nk"> &lt;luke-jr&gt;</span> <span class="hi">gmaxwell:</span> what Eloipool does to solve that, is return a longpollid which is triggered as soon as the full template is available
<a name="l-173"></a><span class="tm">19:51:28</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">BlueMatt:</span> yes but that isn't the tradeoff. Assuming you mine on the template for --say-- 30 seconds, it's 13.4 BTC expected (13.5 - 100ms of mining) vs 12.5.  or whatnot.
<a name="l-174"></a><span class="tm">19:52:27</span><span class="nk"> &lt;sipa&gt;</span> well, we could optionally also make GBT return a partial block and/or block until the full block is available (but not yet TBVed)
<a name="l-175"></a><span class="tm">19:52:39</span><span class="nk"> &lt;gmaxwell&gt;</span> e.g. current fees pay for 100ms of delay easily.
<a name="l-176"></a><span class="tm">19:52:45</span><span class="nk"> &lt;BlueMatt&gt;</span> <span class="hi">gmaxwell:</span> oh? I believe most pools can push a "hard update" or whatever its called
<a name="l-177"></a><span class="tm">19:52:52</span><span class="nk"> &lt;BlueMatt&gt;</span> that will force the asic to switch
<a name="l-178"></a><span class="tm">19:52:52</span><span class="nk"> &lt;sipa&gt;</span> moving the actual construction to the background won't hurt
<a name="l-179"></a><span class="tm">19:52:56</span><span class="nk"> &lt;BlueMatt&gt;</span> there is a flag in stratum for it
<a name="l-180"></a><span class="tm">19:53:16</span><span class="nk"> &lt;BlueMatt&gt;</span> (to flush workqueue in asic)
<a name="l-181"></a><span class="tm">19:53:18</span><span class="nk"> &lt;gmaxwell&gt;</span> <span class="hi">BlueMatt:</span> for some hardware retargeting causes misbehavior/loss of performance.
<a name="l-182"></a><span class="tm">19:53:50</span><span class="nk"> &lt;gmaxwell&gt;</span> In any case, it isn't so simple.
<a name="l-183"></a><span class="tm">19:53:55</span><span class="nk"> &lt;BlueMatt&gt;</span> fair
<a name="l-184"></a><span class="tm">19:54:09</span><span class="nk"> &lt;BlueMatt&gt;</span> I assume most modern hardware supports it, though
<a name="l-185"></a><span class="tm">19:54:13</span><span class="nk"> &lt;BlueMatt&gt;</span> given that most pools do this
<a name="l-186"></a><span class="tm">19:54:19</span><span class="nk"> &lt;BlueMatt&gt;</span> incl pools run by the hardware mfgrs
<a name="l-187"></a><span class="tm">19:54:19</span><span class="nk"> &lt;gmaxwell&gt;</span> Do not assume that.
<a name="l-188"></a><span class="tm">19:54:29</span><span class="nk"> &lt;BlueMatt&gt;</span> ok, fair
<a name="l-189"></a><span class="tm">19:54:40</span><span class="nk"> &lt;sipa&gt;</span> we're running out of time
<a name="l-190"></a><span class="tm">19:54:44</span><span class="nk"> &lt;sipa&gt;</span> any other topics?
<a name="l-191"></a><span class="tm">19:54:49</span><span class="nk"> &lt;gmaxwell&gt;</span> quick, empty messages
<a name="l-192"></a><span class="tm">19:54:52</span><span class="nk"> &lt;sipa&gt;</span> 
<a name="l-193"></a><span class="tm">19:54:54</span><span class="nk"> &lt;luke-jr&gt;</span> 
<a name="l-194"></a><span class="tm">19:55:05</span><span class="nk"> &lt;wumpus&gt;</span> 
<a name="l-195"></a><span class="tm">19:55:22</span><span class="nk"> &lt;gmaxwell&gt;</span> 
<a name="l-196"></a><span class="tm">19:55:31</span><span class="nk"> &lt;luke-jr&gt;</span> inb4 trolls use this as proof we obey gmaxwell
<a name="l-197"></a><span class="tm">19:55:37</span><span class="nk"> &lt;gwillen&gt;</span> 
<a name="l-198"></a><span class="tm">19:56:07</span><span class="nk"> &lt;BlueMatt&gt;</span> lulwut
<a name="l-199"></a><span class="tm">19:56:21</span><span class="nk"> &lt;wumpus&gt;</span> <span class="topic">#topic</span><span class="topicline"></span>
<a name="l-200"></a><span class="tm">19:56:26</span><span class="nk"> &lt;sipa&gt;</span> it's "lolwut", BlueMatt.
<a name="l-201"></a><span class="tm">19:56:38</span><span class="nk"> &lt;BlueMatt&gt;</span> lulzwutz
<a name="l-202"></a><span class="tm">19:56:49</span><span class="nk"> &lt;wumpus&gt;</span> cleared the topic, too, now we can cleanly exit the meeting
<a name="l-203"></a><span class="tm">19:56:50</span><span class="nk"> &lt;gmaxwell&gt;</span> We should appoint a subcommittee to investigate the spelling of lolwut/lulwut.
<a name="l-204"></a><span class="tm">19:56:59</span><span class="nk"> &lt;wumpus&gt;</span> <span class="cmd">#endmeeting</span><span class="cmdline"></span></pre>
</body></html>
